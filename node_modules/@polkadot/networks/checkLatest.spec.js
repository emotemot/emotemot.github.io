"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _xFetch = _interopRequireDefault(require("@polkadot/x-fetch"));

var _util = require("@polkadot/util");

var _ = require("./");

// Copyright 2017-2020 @polkadot/networks authors & contributors
// SPDX-License-Identifier: Apache-2.0
describe('check latest Substrate ss58 registry', () => {
  let original;
  beforeAll(async () => {
    const response = await (0, _xFetch.default)('https://raw.githack.com/paritytech/substrate/master/ss58-registry.json');
    original = await response.json();
  });
  it('has the same number as the original', () => {
    expect(_.all.length).toEqual(original.registry.length);
  });
  it('has no missing any entries', () => {
    const missing = original.registry.filter(({
      prefix
    }) => !_.all.some(n => n.prefix === prefix)).map(({
      displayName,
      prefix
    }) => `${displayName} (${prefix})}`);
    (0, _util.assert)(!missing.length, `Missing entries found: ${missing.join(', ')}`);
  });
  it('has no extra entries', () => {
    const missing = _.all.filter(({
      prefix
    }) => !original.registry.some(n => n.prefix === prefix)).map(({
      displayName,
      prefix
    }) => `${displayName} (${prefix})}`);

    (0, _util.assert)(!missing.length, `Extra entries found: ${missing.join(', ')}`);
  });
  it('has the same values as the original', () => {
    const fields = Object.keys(original.schema);
    const errors = original.registry.map(n => {
      const other = _.all.find(({
        prefix
      }) => prefix === n.prefix);

      return [`${n.displayName} (${n.prefix})`, other // eslint-disable-next-line @typescript-eslint/ban-ts-comment
      // @ts-ignore
      ? fields.filter(f => JSON.stringify(n[f]) !== JSON.stringify(other[f])) : []];
    }).filter(([, fields]) => fields.length);
    (0, _util.assert)(!errors.length, `Mismatches found: ${JSON.stringify(errors.map(([name, m]) => `${name} on ${m.join(', ')}`), null, 2)}`);
  });
});